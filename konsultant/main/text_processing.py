import re
from difflib import get_close_matches

def generate_ngrams(text, n):
    """Генерирует N-граммы из текста"""
    words = preprocess_text(text).split()
    return [' '.join(words[i:i + n]) for i in range(len(words) - n + 1)]


def preprocess_text(text):
    """Очищает текст: убирает знаки препинания и приводит к нижнему регистру"""
    import re

    # Расширенный словарь синонимов
    # synonyms = {
    #     "подгузники": [
    #         "все подгузники",
    #         "какие подгузники у вас есть",
    #         "подгузники список",
    #         "что у вас по подгузникам",
    #         "детские подгузники",
    #     ],
    #     "игрушки": [
    #         "какие игрушки у вас есть",
    #         "что за игрушки у вас",
    #         "какие игрушки можно купить",
    #         "есть ли игрушки",
    #         "что у вас по игрушкам",
    #     ],
    #     "цена подгузников": [
    #         "цена подгузников",
    #         "какая стоимость подгузников",
    #         "подгузники сколько стоят",
    #         "подскажите цену на подгузники",
    #         "какая цена у подгузников",
    #     ],
    #     "подгузники для детей от 11-16 килограмм": [
    #         "подгузники для 13 кг",
    #         "какие подгузники подходят для детей 11-16 кг",
    #         "подгузники от 11 до 16 кг",
    #         "для детей весом 13 кг подгузники",
    #         "какие подгузники для ребенка 11-16 кг",
    #         "подгузники для 11 кг",
    #         "подгузники для 12 кг",
    #         "подгузники для 14 кг",
    #         "подгузники для 15 кг",
    #         "подгузники для 16 кг",
    #     ],
    #     "смесь nan 2 optipro 1050г с 6 месяцев": [
    #         "смесь nan optipro с 6 месяцев",
    #         "nan optipro 2 для 6 месяцев",
    #         "какая смесь nan optipro",
    #         "смесь nan для малышей",
    #         "nan 2 optipro сколько грамм",
    #         "смесь для 6 месяцев",
    #     ],
    #     "плюшевая игрушка синий трактор": [
    #         "есть ли плюшевая игрушка синий трактор",
    #         "синий трактор игрушка для детей",
    #         "какие игрушки синий трактор",
    #         "синий трактор мягкая игрушка",
    #         "детская игрушка синий трактор",
    #         "синий трактор",
    #     ],
    #     "детская игрушка из пластика": [
    #         "игрушка из пластика для детей",
    #         "какие есть пластиковые игрушки",
    #         "игрушки для развлечения из пластика",
    #         "пластиковая игрушка для ребенка",
    #         "игрушки из пластика для детей",
    #     ],
    #     "развивающая игрушка для детей": [
    #         "игрушка из мультфильма для детей",
    #         "какие игрушки для развития ребенка",
    #         "игрушка для ребенка из мультика",
    #         "детские игрушки из мультфильма",
    #         "развивающая игрушка для ребенка",
    #     ],
    #     "подгузники для детей от 4-8 килограмм": [
    #         "подгузники для детей весом 4-8 кг",
    #         "какие подгузники для 4-8 кг",
    #         "подгузник для ребенка 4-8 кг",
    #         "подгузники от 4 до 8 кг",
    #         "для малышей весом 4-8 кг подгузники",
    #         "подгузники для 6 кг",
    #         "подгузники для 7 кг",
    #         "подгузники для 8 кг",
    #     ],
    #     "подгузники для детей от 4 кг": [
    #         "подгузники для 5 кг",
    #     ],
    #     "подгузники для детей от 2-5 килограмм": [
    #         "какие подгузники подходят для 2-5 кг",
    #         "подгузники для малышей 2-5 кг",
    #         "подгузники от 2 до 5 кг",
    #         "подгузники для ребенка весом 2-5 кг",
    #         "для детей 2-5 кг подгузники",
    #         "подгузники для 2 кг",
    #         "подгузники для 3 кг",
    #     ],
    #     "смесь pediasure малоежка ваниль 850г с 12 месяцев": [
    #         "смесь с 12 месяцев",
    #         "pediasure малоежка 850г",
    #         "смесь pediasure для детей 12 месяцев",
    #         "малоежка ванильная смесь 850г",
    #         "pediasure смесь для малышей",
    #     ],
    #     "подгузники": [
    #         "все подгузники",
    #         "какие подгузники у вас есть",
    #         "подгузники список",
    #         "что у вас по подгузникам",
    #         "детские подгузники",
    #     ],
    #     "оформить заказ": [
    #         "как оформить заказ",
    #         "как сделать заказ",
    #         "как заказать товар",
    #         "оформление заказа",
    #         "как купить у вас товар",
    #     ],
    #     "отследить заказ": [
    #         "где отслеживать заказ",
    #         "как узнать статус заказа",
    #         "где посмотреть мой заказ",
    #         "статус моего заказа",
    #         "как проверить заказ",
    #     ],
    #     "вернуть товар": [
    #         "как вернуть товар",
    #         "возврат товара возможен",
    #         "могу ли я вернуть покупку",
    #         "как сделать возврат товара",
    #         "какие условия возврата",
    #     ],
    #     "что такое pediasure": [
    #         "pediasure что это",
    #         "для чего нужна смесь pediasure",
    #         "описание pediasure",
    #         "как действует pediasure",
    #         "что входит в pediasure",
    #     ],
    # }

    text = text.lower()  # Приводим текст к нижнему регистру

    # Проверяем на схожие запросы
    for key, synonym_list in synonyms.items():
        match = get_close_matches(text, synonym_list, n=1, cutoff=0.8)
        if match:
            return key  # Возвращаем основное слово

    return text  # Если ничего не найдено